// Генератор отчета на основе выбранных пунктов
(function() {
  'use strict';

  // Данные для каждого пункта проверки
  const reportData = {
    1: {
      title: 'Проверка достоверности анкетных данных и предоставленных сведений',
      table: {
        title: 'Таблица: Проверка достоверности анкетных данных',
        headers: ['Параметр', 'Заявлено', 'Проверено', 'Статус'],
        rows: [
          ['ФИО', 'Иванов Иван Иванович', 'Иванов Иван Иванович', 'Соответствует'],
          ['Дата рождения', '01.01.1990', '01.01.1990', 'Соответствует'],
          ['Паспорт', '1234 567890', '1234 567890', 'Соответствует']
        ]
      },
      summary: 'Аналитическая сводка: Все анкетные данные проверены и подтверждены соответствующими документами. Несоответствий не обнаружено.',
      both: 'Полный отчет включает таблицу с детальной проверкой и аналитическую сводку.'
    },
    2: {
      title: 'Перечень мест проживания и регистрации',
      table: {
        title: 'Таблица: Места проживания и регистрации',
        headers: ['Адрес', 'Тип', 'Период', 'Статус'],
        rows: [
          ['г. Москва, ул. Ленина, д. 10, кв. 5', 'Постоянная регистрация', '2010 - по н.в.', 'Подтверждено'],
          ['г. Санкт-Петербург, пр. Невский, д. 20', 'Временная регистрация', '2015-2017', 'Подтверждено']
        ]
      },
      summary: 'Аналитическая сводка: Выявлено 2 места регистрации. Все адреса проверены и подтверждены. Подозрительных изменений места жительства не обнаружено.',
      both: 'Полный отчет включает таблицу с адресами и аналитическую сводку.'
    },
    3: {
      title: 'Сведения о задолженностях',
      table: {
        title: 'Таблица: Сведения о задолженностях',
        headers: ['Кредитор', 'Сумма задолженности', 'Статус', 'Дата'],
        rows: [
          ['Банк А', '0 руб.', 'Нет задолженности', '-'],
          ['Кредитное бюро', '0 руб.', 'Нет задолженности', '-']
        ]
      },
      summary: 'Аналитическая сводка: Проверка кредитной истории не выявила задолженностей. Кредитный рейтинг в норме.',
      both: 'Полный отчет включает таблицу с задолженностями и аналитическую сводку.'
    },
    4: {
      title: 'Сведения о судимостях (административная, уголовная, гражданская практика)',
      table: {
        title: 'Таблица: Сведения о судимостях',
        headers: ['Тип дела', 'Статус', 'Результат', 'Дата'],
        rows: [
          ['Административные правонарушения', 'Отсутствуют', '-', '-'],
          ['Уголовные дела', 'Отсутствуют', '-', '-'],
          ['Гражданские дела', 'Отсутствуют', '-', '-']
        ]
      },
      summary: 'Аналитическая сводка: Судимости отсутствуют. Административных и уголовных правонарушений не обнаружено.',
      both: 'Полный отчет включает таблицу с судимостями и аналитическую сводку.'
    },
    5: {
      title: 'Наличие криминальной истории и социального негатива',
      table: {
        title: 'Таблица: Криминальная история и социальный негатив',
        headers: ['Источник', 'Найденная информация', 'Оценка', 'Дата проверки'],
        rows: [
          ['Базы данных МВД', 'Записей не найдено', 'Положительно', '2024-01-15'],
          ['Интернет-источники', 'Негативной информации не обнаружено', 'Положительно', '2024-01-15']
        ]
      },
      summary: 'Аналитическая сводка: Криминальная история отсутствует. Социального негатива в открытых источниках не выявлено.',
      both: 'Полный отчет включает таблицу с проверкой и аналитическую сводку.'
    },
    6: {
      title: 'Проверка трудовой деятельности кандидата',
      table: {
        title: 'Таблица: Трудовая деятельность',
        headers: ['Период работы', 'Организация', 'Должность', 'Статус подтверждения'],
        rows: [
          ['2020-2024', 'ООО "Компания А"', 'Менеджер', 'Подтверждено'],
          ['2018-2020', 'ООО "Компания Б"', 'Специалист', 'Подтверждено']
        ]
      },
      summary: 'Аналитическая сводка: Трудовая деятельность подтверждена. Все указанные места работы верифицированы. Перерывов в трудовой деятельности не обнаружено.',
      both: 'Полный отчет включает таблицу с трудовой деятельностью и аналитическую сводку.'
    },
    7: {
      title: 'Аффилированность проверяемого лица на участие в коммерческой деятельности',
      table: {
        title: 'Таблица: Коммерческая деятельность',
        headers: ['Организация', 'Роль', 'Статус', 'Дата регистрации'],
        rows: [
          ['ООО "Индивидуальное предпринимательство"', 'Учредитель', 'Активна', '2015-03-20']
        ]
      },
      summary: 'Аналитическая сводка: Выявлена аффилированность с коммерческой организацией. Рекомендуется дополнительная проверка на конфликт интересов.',
      both: 'Полный отчет включает таблицу с коммерческой деятельностью и аналитическую сводку.'
    },
    8: {
      title: 'Скрининг активности в интернет-пространстве',
      conclusion: 'Заключение: Проведен комплексный скрининг активности в интернет-пространстве. Проверены социальные сети, форумы, публичные базы данных. Компрометирующей информации не обнаружено. Репутация кандидата в сети соответствует профессиональному имиджу.'
    },
    9: {
      title: 'Проверка достоверности документа подтверждающего образование кандидата (запрос в ВУЗ)',
      conclusion: 'Заключение: Запрос направлен в соответствующий ВУЗ. Ожидается подтверждение информации об образовании. Предварительная проверка документов показывает их подлинность.'
    },
    10: {
      title: 'Выявление актуального места проживания проверяемого лица',
      conclusion: 'Заключение: Актуальное место проживания идентифицировано и верифицировано. Соответствует данным регистрации. Дополнительных адресов не обнаружено.'
    },
    11: {
      title: 'Аффилированные лица / Родственники',
      table: {
        title: 'Таблица: Аффилированные лица и родственники',
        headers: ['ФИО', 'Связь', 'Роль', 'Организация'],
        rows: [
          ['Иванова Мария Петровна', 'Родственник', 'Нет связи с конкурентами', '-'],
          ['Петров Петр Иванович', 'Родственник', 'Нет связи с конкурентами', '-']
        ]
      },
      summary: 'Сводка: Проверка родственных связей не выявила конфликтов интересов. Аффилированности с конкурирующими организациями не обнаружено.'
    },
    12: {
      title: 'Получение письменного отзыва по кандидату по предыдущему месту работы',
      review: 'Отзыв: Кандидат проработал в организации с 2020 по 2024 год на должности менеджера. Проявил себя как ответственный и квалифицированный сотрудник. Профессиональные качества оценены положительно. Рекомендуется к трудоустройству.'
    },
    13: {
      title: 'Наличие двойного гражданства',
      conclusion: 'Заключение: Информация о двойном гражданстве отсутствует. Гражданство Российской Федерации подтверждено. Дополнительных гражданств не обнаружено.'
    },
    14: {
      title: 'Конкурентная «контразведка». Наличие учредительства или участия в ЮЛ, являющихся конкурентами компании.',
      conclusion: 'Заключение: Проведена проверка на участие в конкурентных организациях. Связей с конкурентами компании не обнаружено. Конфликт интересов отсутствует.'
    },
    15: {
      title: 'Наличие двойного гражданства',
      result: 'Результат проверки: Повторная проверка подтвердила отсутствие двойного гражданства. Все документы проверены и верифицированы.'
    },
    16: {
      title: 'Организация собеседования кандидата со специалистом службы безопасности (профайлинг)',
      conclusion: 'Заключение: Собеседование с кандидатом проведено. Профайлинг не выявил признаков неискренности или скрываемой информации. Психологический профиль соответствует заявленным характеристикам.'
    }
  };

  // Функция для генерации таблицы (2 столбца: параметр, значение)
  function generateTable(data) {
    if (!data.table) return '';

    let html = `<table class="report__generated-table">
      <thead>
        <tr>
          <th>Параметр</th>
          <th>Значение</th>
        </tr>
      </thead>
      <tbody>`;
    
    // Преобразуем строки в формат "параметр, значение"
    data.table.rows.forEach(row => {
      // Первая ячейка - параметр
      const parameter = row[0];
      // Остальные ячейки объединяем в значение
      const value = row.slice(1).filter(cell => cell && cell !== '-').join('; ');
      
      html += `<tr>
        <td>${parameter}</td>
        <td>${value || '-'}</td>
      </tr>`;
    });
    
    html += `</tbody>
    </table>`;
    
    return html;
  }

  // Функция для генерации сводки (простой текст)
  function generateSummary(data) {
    if (!data.summary) return '';
    
    // Извлекаем текст без префикса "Аналитическая сводка:"
    const summaryText = data.summary.replace(/^Аналитическая сводка:\s*/i, '');
    
    return `<div class="report__summary-text">${summaryText}</div>`;
  }

  // Функция для генерации полного отчета (таблица + сводка)
  function generateBoth(data) {
    let html = '';
    
    if (data.table) {
      html += generateTable(data);
    }
    
    if (data.summary) {
      html += generateSummary(data);
    }
    
    return html;
  }

  // Функция для генерации заключения (преобразуем в таблицу)
  function generateConclusion(data) {
    if (!data.conclusion) return '';
    
    // Извлекаем текст без префикса "Заключение:"
    const conclusionText = data.conclusion.replace(/^Заключение:\s*/i, '');
    
    return `<table class="report__generated-table">
      <thead>
        <tr>
          <th>Параметр</th>
          <th>Значение</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Заключение</td>
          <td>${conclusionText}</td>
        </tr>
      </tbody>
    </table>`;
  }

  // Функция для генерации отзыва (преобразуем в таблицу)
  function generateReview(data) {
    if (!data.review) return '';
    
    // Извлекаем текст без префикса "Отзыв:"
    const reviewText = data.review.replace(/^Отзыв:\s*/i, '');
    
    return `<table class="report__generated-table">
      <thead>
        <tr>
          <th>Параметр</th>
          <th>Значение</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Отзыв</td>
          <td>${reviewText}</td>
        </tr>
      </tbody>
    </table>`;
  }

  // Функция для генерации результата (преобразуем в таблицу)
  function generateResult(data) {
    if (!data.result) return '';
    
    // Извлекаем текст без префикса "Результат проверки:"
    const resultText = data.result.replace(/^Результат проверки:\s*/i, '');
    
    return `<table class="report__generated-table">
      <thead>
        <tr>
          <th>Параметр</th>
          <th>Значение</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Результат проверки</td>
          <td>${resultText}</td>
        </tr>
      </tbody>
    </table>`;
  }

  // Основная функция генерации отчета
  function generateReport() {
    const contentContainer = document.getElementById('reportGeneratedContent');
    if (!contentContainer) return;

    // Получаем все выбранные радиокнопки
    const selectedItems = [];
    const radioButtons = document.querySelectorAll('.report__radio:checked');
    
    if (radioButtons.length === 0) {
      contentContainer.innerHTML = '<p class="report__empty-message">Выберите пункты проверки в левой таблице для формирования отчета</p>';
      return;
    }

    let reportHTML = '';

    radioButtons.forEach(radio => {
      const name = radio.getAttribute('name');
      const value = radio.getAttribute('value');
      const rowIndex = parseInt(name.replace('output', ''));
      
      if (reportData[rowIndex]) {
        const data = reportData[rowIndex];
        
        reportHTML += `<div class="report__item">
          <h3 class="report__item-title">${data.title}</h3>`;

        switch(value) {
          case 'table':
            reportHTML += generateTable(data);
            break;
          case 'summary':
            reportHTML += generateSummary(data);
            break;
          case 'both':
            reportHTML += generateBoth(data);
            break;
          case 'conclusion':
            reportHTML += generateConclusion(data);
            break;
          case 'review':
            reportHTML += generateReview(data);
            break;
          case 'result':
            reportHTML += generateResult(data);
            break;
        }
        
        reportHTML += `</div>`;
      }
    });

    contentContainer.innerHTML = reportHTML;
  }

  // Инициализация при загрузке страницы
  function init() {
    // Добавляем обработчики событий для всех радиокнопок
    const radioButtons = document.querySelectorAll('.report__radio');
    radioButtons.forEach(radio => {
      radio.addEventListener('change', generateReport);
    });

    // Генерируем начальный отчет
    generateReport();
  }

  // Запускаем при загрузке DOM
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
